define("ContextMenu",["jquery","Urushi","materialConfig","_CollectionWidgetBase","_ContextMenuItem","legacy","animation","text!contextMenuTemplate"],function(t,e,i,o,n,s,c,a){"use strict";var l={ID_PREFIX:"urushi.context-menu",ITEM_ID_PREFIX:".item",EMBEDDED:{contextMenuClass:"",additionalClass:""},DURATION:150,ITEMS_TRANSITION_DURATION:150,ITEMS_LI_MARGIN:20,MINIMUM_WIDTH:100,CONTEXTMENU_WIDTH:48},r=0;return o.extend({template:void 0,embedded:void 0,contentWidth:void 0,defaultCallback:void 0,onClickContextCallbacks:void 0,onClickItemCustomArgs:void 0,bubbling:void 0,type:void 0,itemIdNo:void 0,animationDeferred:void 0,closeIconAnimationDeferred:void 0,_initProperties:function(t){this._super(t),this.template=a,this.embedded=l.EMBEDDED,this.contentWidth=-1,this.onClickContextCallbacks=[],this.onClickItemCustomArgs=[],this.itemIdNo=0,this.animationDeferred=void 0,this.defaultCallback=t.defaultCallback,this._setBubbling(t.bubbling)},_setBubbling:function(t){"boolean"==typeof t&&(this.bubbling=t)},_setType:function(t){"grid"===t?(this.rootNode.classList.add("type-grid"),this.type="grid"):(this.rootNode.classList.remove("type-grid"),this.type=void 0)},initOption:function(t){this._setType(t.type||!1),this.itemsNode.tabIndex=-1,t.items&&this.addItems(t.items),e.addEvent(this.contextMenuIconNode,"click",this,"onClickContext"),e.addEvent(this.closeIconNode,"click",this,"onClickClose"),e.addEvent(this.itemsNode,"blur",this,"onBlurContext"),e.hasTransitionSupport()||(e.addEvent(this.closeIconNode,"mouseenter",this,"_onCloseIconMouseEnter"),e.addEvent(this.closeIconNode,"mouseleave",this,"_onCloseIconMouseLeave"))},addItems:function(t){var e,i;if(t instanceof Array){for(e=0,i=t.length;i>e;e++)t[e].callback=t[e].callback||this.defaultCallback,this._addItem(t[e]);this._setContentWidth()}},getItem:function(t){return this.getSubItem(t)},getItems:function(){return this.getSubItems()},setupShowItems:function(t){var e,i,o=t instanceof Array?t:Array.prototype.slice.call(arguments),n=function(t){return o.indexOf(t)>-1},s=this.getItems(),c=s.length;for(e=0;c>e;e++)i=s[e],i.setHidden(!n(i.id))},setHiddenItem:function(t){var e,i,o,n=Array.prototype.slice.call(arguments,1);if("boolean"!=typeof t)return!1;for(0===n.length&&(n=this.getSubItemIds()),e=0,o=n.length;o>e;e++)i=this.getItem(n[e]),i&&i.setHidden(t);return!0},isHiddenItem:function(t){var e=this.getItem(t);if(e)return e.isHidden()},removeItems:function(){var t,e,i,o=Array.prototype.slice.call(arguments);for(0===o.length&&(o=this.getSubItemIds()),t=0,e=o.length;e>t;t++)i=this.getItem(o[t]),i&&i.destroy()},_removeItem:function(t){e.removeEvent(this.itemsMap[t].node,"click",this,"onClickItem"),this.listNode.removeChild(this.itemsMap[t].node),delete this.itemsMap[t]},_addItem:function(t){var e,i;if(!(t&&t.hasOwnProperty("name")&&t.name&&t.hasOwnProperty("label")&&t.label))throw new Error("Item must have name and label.");e={owner:this,id:t.name,liId:t.liId,label:t.label,icon:t.icon,callback:t.callback},i=new n(e),this.listNode.appendChild(i.node)},_setContentWidth:function(){var t,e,i,o=this.getItems(),n=-1;for(t=0,e=o.length;e>t;t++)i=o[t],i.width>n&&(n=i.width);this.contentWidth=n+2*l.ITEMS_LI_MARGIN,this.contentWidth=this.contentWidth>l.MINIMUM_WIDTH?this.contentWidth:l.MINIMUM_WIDTH},setCallback:function(t){var e,i,o,n=Array.prototype.slice.call(arguments).slice(1);if("function"==typeof t)for(0===n.length&&(n=this.getSubItemIds()),e=0,i=n.length;i>e;e++)o=this.getItem(n[e]),o&&o.setCallback(t)},clearOnClickItemCustomArgs:function(){this.onClickItemCustomArgs=[]},addOnClickItemCustomArgs:function(){var t,e;for(t=0,e=arguments.length;e>t;t++)this.onClickItemCustomArgs.push(arguments[t])},_onRemoveSubItem:function(t){this._setContentWidth()},onClickItem:function(t){var e,i,o,n=[];if(this._close(),"function"==typeof t.callback){for(n.push(t.id),i=0,o=this.onClickItemCustomArgs.length;o>i;i++)n.push(this.onClickItemCustomArgs[i]);e=function(){t.callback.apply(this,n)},setTimeout(e,l.ITEMS_TRANSITION_DURATION)}},addOnClickContextCallback:function(t){if("function"!=typeof t)throw new Error("addOnClickContextCallback : Specify function.");this.onClickContextCallbacks.push(t)},onClickContext:function(i){var o,n,s,a,r,d,h,m=this.listNode.childNodes,u=[],I=function(t){return function(){t.classList.add("show"),e.hasTransitionSupport()||c.animate(l.DURATION,function(e){t.style[c.STYLEKEYS.transform]="scale("+e+")",t.style.opacity=e}).then(function(){t.style[c.STYLEKEYS.transform]="",t.style.opacity=""})}};if(!this.isDisabled()&&!this.disabled){for(o=0,n=m.length;n>o;o++)m[o].classList.contains("hidden")||u.push(m[o]);if(u.length&&(this.bubbling||i.stopPropagation(),!this.itemsNode.classList.contains("items-open"))){for(this.itemsNode.tabIndex=0,s=n*t(u[0]).outerHeight(),a=t(this.closeIconWrapperNode).outerHeight(),r=s+a,this.itemsNode.style.maxHeight=r+"px",this.itemsNode.style.minWidth=this.contentWidth+"px",h="grid"===this.type?32:l.CONTEXTMENU_WIDTH,this.itemsNode.style.right=this.contentWidth-h+"px",this.itemsNode.classList.add("items-open"),e.hasTransitionSupport()||(this.animationDeferred&&(this.animationDeferred.cancel(),this.animationDeferred=void 0),this.animationDeferred=c.animate(l.DURATION,function(t){this.itemsNode.style[c.STYLEKEYS.transform]="scale("+t+")"}.bind(this)).then(function(){this.itemsNode.style[c.STYLEKEYS.transform]="",this.animationDeferred=void 0}.bind(this))),o=0,n=u.length;n>o;o++)d=I(u[o]),setTimeout(d,l.ITEMS_TRANSITION_DURATION+30*o);for(d=I(this.closeIconNode),setTimeout(d,l.ITEMS_TRANSITION_DURATION+30*(u.length-1)),this.itemsNode.focus(),o=0,n=this.onClickContextCallbacks.length;n>o;o++)this.onClickContextCallbacks[o](this)}}},_close:function(){var t,i=this.listNode.childNodes,o=i.length;if(this.itemsNode.classList.contains("items-open")){for(this.itemsNode.tabIndex=-1,this.itemsNode.classList.remove("items-open"),e.hasTransitionSupport()||(this.animationDeferred&&(this.animationDeferred.cancel(),this.animationDeferred=void 0),this.animationDeferred=c.animate(l.DURATION,function(t){this.itemsNode.style[c.STYLEKEYS.transform]="scale("+(1-t)+")"}.bind(this)).then(function(){this.itemsNode.style[c.STYLEKEYS.transform]="",this.animationDeferred=void 0}.bind(this))),t=0;o>t;t++)i[t].classList.remove("show");this.closeIconNode.classList.remove("show")}},onBlurContext:function(t){t.stopPropagation(),this._close()},onClickClose:function(t){t.stopPropagation(),this._close()},_attachNode:function(){this.contextMenuIconNode=this.rootNode.getElementsByClassName("context-menu")[0],this.itemsNode=this.rootNode.getElementsByClassName("items")[0],this.listNode=this.rootNode.getElementsByClassName("items-list")[0],this.closeIconWrapperNode=this.rootNode.getElementsByClassName("close-icon-wrapper")[0],this.closeIconNode=this.rootNode.getElementsByClassName("close-icon")[0]},_getId:function(){return l.ID_PREFIX+r++},_onCloseIconMouseEnter:function(){this.closeIconAnimationDeferred&&(this.closeIconAnimationDeferred.cancel(),this.closeIconAnimationDeferred=void 0),this.closeIconAnimationDeferred=c.animate(l.DURATION,function(t){this.closeIconNode.style[c.STYLEKEYS.transform]="rotate("+90*t+"deg)"}.bind(this)).then(function(){this.closeIconAnimationDeferred=void 0}.bind(this))},_onCloseIconMouseLeave:function(){this.closeIconAnimationDeferred&&(this.closeIconAnimationDeferred.cancel(),this.closeIconAnimationDeferred=void 0),this.closeIconAnimationDeferred=c.animate(l.DURATION,function(t){this.closeIconNode.style[c.STYLEKEYS.transform]="rotate("+(90-90*t)+"deg)"}.bind(this)).then(function(){this.closeIconNode.style[c.STYLEKEYS.transform]="",this.closeIconAnimationDeferred=void 0}.bind(this))},_getItemId:function(){return this.id+l.ITEM_ID_PREFIX+this.itemIdNo++},destroy:function(){e.removeEvent(this.contextMenuIconNode,"click",this,"onClickContext"),e.removeEvent(this.closeIconNode,"click",this,"onClickClose"),e.removeEvent(this.itemsNode,"blur",this,"onBlurContext"),e.hasTransitionSupport()||(e.removeEvent(this.closeIconNode,"mouseenter",this,"_onCloseIconMouseEnter"),e.removeEvent(this.closeIconNode,"mouseleave",this,"_onCloseIconMouseLeave")),this._super()}})});