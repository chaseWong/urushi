define("DropDown",["jquery","Urushi","legacy","materialConfig","animation","_Base","text!dropDownTemplate"],function(t,e,i,s,o,n,l){"use strict";var d={ID_PREFIX:"urushi.DropDown",ID_PREFIX_ITEM:"urushi.DropDown.item",EMBEDDED:{additionalClass:""},TIMEOUT_TRIGGER:10,LIST_PLACE_TOP_RIGHT:"top-right",LIST_PLACE_BOTTOM_RIGHT:"bottom-right",ATTRIBUTE_INPUT_ITEM_SELECTED_VALUE:"data-value",ATTRIBUTE_UL_ITEM_SELECTED_ID:"data-selected-id",ATTRIBUTE_LI_ITEM_VALUE:"data-value",CLASS_ITEM_SELECTED:"selected",MENULIST_MIN_WIDTH:200},h=0,a=0;return n.extend({template:void 0,embedded:void 0,opened:!1,items:void 0,itemsByValue:void 0,animDeferred:void 0,_initProperties:function(t){this.template=l,this.embedded=d.EMBEDDED,this.items={},this.itemsByValue={},this.opened=!1,this.animDeferred=null},initOption:function(t){t.items&&this.addItems(t.items),e.addEvent(this.inputNode,"click",this,"_onClickInput"),e.addEvent(this.inputNode,"focus",this,"_onClickInput"),e.addEvent(this.inputNode,"blur",this,"_onBlurInput"),e.addEvent(this.inputNode,"keydown",this,"_onKeydownInput"),e.addEvent(this.listNode,"mousedown",this,"_onMousedownList"),this.listNode.classList.add("hidden")},_addItem:function(t){var i,s,o,n,l;t&&t.hasOwnProperty("value")&&(i=document.createElement("li"),n=i.id=this._getItemId(),s=t.label||"",i.textContent=t.label||"Â ",i.className=t["class"]||"",o=t.value,i.setAttribute(d.ATTRIBUTE_LI_ITEM_VALUE,t.value),e.addEvent(i,"click",this,"_onSelectItem",{target:i}),this.listNode.appendChild(i),l={label:s,value:o,node:i},this.items[n]=l,this.itemsByValue[o]=l,t.selected&&this._onSelect(i))},addItems:function(t){var e,i;if(t instanceof Array)for(e=0,i=t.length;i>e;e++)this._addItem(t[e])},removeItem:function(t){var i,s,o,n=this.itemsByValue[t];n&&(o=this.getSelectedItem(),s=n.node,i=s.id,e.removeEvent(s,"click",this,"_onSelectItem"),this.listNode.removeChild(s),delete this.items[i],delete this.itemsByValue[t],o===n&&this.listNode.childNodes.length>0&&this._onSelect(this.listNode.childNodes[0]))},removeAllItems:function(){var t;for(t in this.itemsByValue)this.removeItem(t)},_onSelect:function(t){var e=t.id,i=this.items[e];t.classList.add(d.CLASS_ITEM_SELECTED),this.listNode.setAttribute(d.ATTRIBUTE_UL_ITEM_SELECTED_ID,e),this.inputNode.value=i.label,this.inputNode.setAttribute(d.ATTRIBUTE_INPUT_ITEM_SELECTED_VALUE,i.value)},_onSelectItem:function(t,e){var i=t.target;this.onSelect(i),this._closeDropDownMenu()},onSelect:function(t){this.clearSelected(),this._onSelect(t)},setSelected:function(t){var e=this.itemsByValue[t];e&&this.onSelect(e.node)},getSelectedItem:function(){return this.items[this.listNode.getAttribute(d.ATTRIBUTE_UL_ITEM_SELECTED_ID)||""]},getSelectedNode:function(){var t=this.getSelectedItem();return t?t.node:void 0},getSelectedValue:function(){var t=this.getSelectedItem();return t?t.value:void 0},clearSelected:function(){var t,e,i=Array.prototype.slice.call(this.listNode.getElementsByClassName(d.CLASS_ITEM_SELECTED));for(t=0,e=i.length;e>t;t++)i[t].classList.remove(d.CLASS_ITEM_SELECTED)},_onMousedownList:function(t){t.preventDefault(),this.cancelBlur=!0,setTimeout(function(){delete this.cancelBlur,this.inputNode.focus()}.bind(this),1)},_onClickInput:function(e){var i,s,o,n,l,h=this.listNode.childNodes,a=h.length;this.inputNode.getAttribute("disabled")||this.readonly||a&&(this.opened||(this.listNode.classList.remove("hidden"),i=a*t(h[0]).outerHeight(),s=t(this.inputNode).outerHeight(),o=t(this.inputNode).offset().top,l=window.innerHeight/2-s,l>i?(this.listNode.classList.remove("scroll"),n=i):(this.listNode.classList.add("scroll"),n=l),o+n+s<t(document).scrollTop()+window.innerHeight?this.listNode.setAttribute("data-placement",d.LIST_PLACE_TOP_RIGHT):this.listNode.setAttribute("data-placement",d.LIST_PLACE_BOTTOM_RIGHT),this.listNode.style.maxHeight=n+"px",this._openDropDownMenu(n)))},_onBlurInput:function(t){return this.cancelBlur?void delete this.cancelBlur:void this._closeDropDownMenu()},_onKeydownInput:function(t){var i,s=e.getKeyCode(t);this.opened?s===e.KEYCODE.ENTER?(this._onBlurInput(t),t.stopPropagation()):s===e.KEYCODE.ESCAPE?(this._onBlurInput(t),t.stopPropagation()):s===e.KEYCODE.UP?(this._moveDisplayItems(-1,this.listNode.childNodes.length-1,0),t.stopPropagation(),t.preventDefault()):s===e.KEYCODE.DOWN?(this._moveDisplayItems(1,0,this.listNode.childNodes.length-1),t.stopPropagation(),t.preventDefault()):s===e.KEYCODE.HOME?(this._moveSelection(0),t.stopPropagation(),t.preventDefault()):s===e.KEYCODE.END?(this._moveSelection(this.listNode.childNodes.length-1),t.stopPropagation(),t.preventDefault()):s===e.KEYCODE.PAGE_UP?(i=Math.floor(this.listNode.offsetHeight/this.listNode.childNodes[0].offsetHeight),this._moveDisplayItems(-i,this.listNode.childNodes.length-1,0),t.stopPropagation(),t.preventDefault()):s===e.KEYCODE.PAGE_DOWN&&(i=Math.floor(this.listNode.offsetHeight/this.listNode.childNodes[0].offsetHeight),this._moveDisplayItems(i,0,this.listNode.childNodes.length-1),t.stopPropagation(),t.preventDefault()):[e.KEYCODE.ENTER,e.KEYCODE.SPACE,e.KEYCODE.UP,e.KEYCODE.DOWN].indexOf(s)>-1&&(this._onClickInput(t),t.stopPropagation(),t.preventDefault())},_moveDisplayItems:function(t,e,i){var s,o,n=NaN;s=this.getSelectedNode(),s?(n=Array.prototype.slice.apply(this.listNode.childNodes).indexOf(s),o=n+t,(0>o||this.listNode.childNodes.length<=o)&&(o=i)):o=e,this._moveSelection(o)},_moveSelection:function(t){var e,i,s=NaN;e=this.getSelectedNode(),e&&(s=Array.prototype.slice.apply(this.listNode.childNodes).indexOf(e)),s!==t&&(i=this.listNode.childNodes[t],this.onSelect(i),this._makeVisibleItem(i))},_makeVisibleItem:function(t){this.listNode.classList.contains("scroll")&&(this.listNode.scrollTop+this.listNode.offsetHeight<t.offsetTop+t.offsetHeight?this._setScrollVisibleBottom(t):this.listNode.scrollTop>t.offsetTop&&this._setScrollVisibleTop(t))},_makeVisibleItemForInit:function(t){t&&this.listNode.classList.contains("scroll")&&(this.listNode.getAttribute("data-placement")===d.LIST_PLACE_TOP_RIGHT?this._setScrollVisibleTop(t):this._setScrollVisibleBottom(t))},_setScrollVisibleTop:function(t){this.listNode.scrollTop=t.offsetTop},_setScrollVisibleBottom:function(t){this.listNode.scrollTop=t.offsetTop+t.offsetHeight-this.listNode.offsetHeight},_attachNode:function(){this.mainNode=this.rootNode.getElementsByClassName("dropdown")[0],this.inputNode=this.rootNode.getElementsByTagName("input")[0],this.listNode=this.rootNode.getElementsByTagName("ul")[0]},_getId:function(){return d.ID_PREFIX+h++},_getItemId:function(){return d.ID_PREFIX_ITEM+a++},_openDropDownMenu:function(e){var i,n,l,h,a,r;this.opened||(this.inputNode.classList.add("focus"),i=Math.max(t(this.mainNode).parent().width(),d.MENULIST_MIN_WIDTH),n=t(this.listNode.childNodes[0]).outerHeight(),t(this.listNode).find("li").css({width:i,height:n}),this.listNode.style.minWidth=0,this.listNode.classList.remove("hidden"),this.animDeferred?(this.animDeferred.cancel(),h=this.listNode.offsetWidth,a=this.listNode.offsetHeight,r=this.listNode.style.opacity):(this.listNode.style.width=0,this.listNode.style.height=0,h=0,a=0,r=0),l=this.getSelectedNode(),this.animDeferred=o.animate(s.DEFAULT_VALUE_DURATION,function(t){this.listNode.style.width=o.calcPoint(h,i,t)+"px",this.listNode.style.height=o.calcPoint(a,e,t)+"px",this.listNode.style.opacity=o.calcPoint(r,1,t),this._makeVisibleItemForInit(l)}.bind(this)).then(function(){this.listNode.style.minWidth="",this._makeVisibleItemForInit(l),this.animDeferred=null}.bind(this)),this.opened=!0)},_closeDropDownMenu:function(){var t,e,i;this.listNode.style.minWidth=0,this.animDeferred&&this.animDeferred.cancel(),t=this.listNode.offsetWidth,e=this.listNode.offsetHeight,i=this.listNode.style.opacity,this.animDeferred=o.animate(s.DEFAULT_VALUE_DURATION,function(s){this.listNode.style.width=o.calcPoint(t,0,s)+"px",this.listNode.style.height=o.calcPoint(e,0,s)+"px",this.listNode.style.opacity=o.calcPoint(i,0,s)}.bind(this)).then(function(){this.listNode.classList.add("hidden"),this.inputNode.classList.remove("focus"),this.animDeferred=null}.bind(this)),this.opened=!1},setDisabled:function(t){return this._super(t)?(t?(this.inputNode.setAttribute("tabIndex","-1"),this.inputNode.setAttribute("disabled",!0)):(this.inputNode.removeAttribute("tabIndex"),this.inputNode.removeAttribute("disabled")),!0):!1},destroy:function(){var t,i,s=this.listNode.childNodes,o=s.length;for(e.removeEvent(this.inputNode,"click",this,"_onClickInput"),e.removeEvent(this.inputNode,"focus",this,"_onClickInput"),e.removeEvent(this.inputNode,"blur",this,"_onBlurInput"),e.removeEvent(this.inputNode,"keydown",this,"_onKeydownInput"),e.removeEvent(this.listNode,"mousedown",this,"_onMousedownList"),t=0;o>t;t++)i=s[t],e.removeEvent(i,"click",this,"_onSelectItem");this._super()}})});